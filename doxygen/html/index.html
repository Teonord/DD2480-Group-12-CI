<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Group 12 CI: CI: A simple C++ Continuous Integration server for GitHub</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Group 12 CI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CI: A simple C++ Continuous Integration server for GitHub </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<h2><a class="anchor" id="autotoc_md1"></a>
Group 12's submission for Assignment 2 in DD2480 Software Engineering Fundamentals</h2>
<p>C++ program that compiles and tests GitHub repositories, updates the status of the commit on completion.</p>
<p>This program can be linked as a webhook to GitHub repositories, after which it will run on any push and pull request. The code will run the Makefile to both compile and test the program. The server will then send a mail to the tester with information about whether the program passed or not.</p>
<p>The program also allows the user to go to <code>/list</code> to get a list of all previous runs, and these runs can be clicked to get further information.</p>
<p>The program will most likely be running on <a href="basically-sure-piranha.ngrok-free.app">This Link</a> for the presentation.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Structure</h1>
<ul>
<li><b>external</b><ul>
<li>Contains external code developed by other developers, namely the header libraries used.</li>
</ul>
</li>
<li><b>include</b><ul>
<li>Contains header files for our own developed code and program.</li>
</ul>
</li>
<li><b>src</b><ul>
<li>Contains the developed code, split into two files, one for atomic functions and one for the main function.</li>
</ul>
</li>
<li><b>tests</b><ul>
<li>Contains the unit tests for all developed functions in the code. Uses the Catch2 framework from "external/"</li>
</ul>
</li>
<li><b>Makefile</b><ul>
<li>Contains functions to easily compile and test the program, further usage explained below.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Running Code</h1>
<p>This assumes you are running <b>Ubuntu</b> for your local computer.</p>
<p>Clone the project</p>
<div class="fragment"><div class="line">git clone git@github.com:Teonord/DD2480-Group-12-CI.git</div>
</div><!-- fragment --><p>Go to the project directory</p>
<div class="fragment"><div class="line">cd DD2480-Group-12-CI</div>
</div><!-- fragment --><p>Install Dependencies</p>
<div class="fragment"><div class="line">sudo apt install make g++ libsqlite3-dev libssl-dev</div>
</div><!-- fragment --><p>Compile the files</p>
<div class="fragment"><div class="line">make </div>
</div><!-- fragment --><p>Export your GitHub API Authentication key for Commit Status Changes (needs permissions for Read and Write access to commit statuses)</p>
<div class="fragment"><div class="line">export GITHUB_API_TOKEN=&lt;token&gt;</div>
</div><!-- fragment --><p>Run the code</p>
<div class="fragment"><div class="line">./build/ci</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Running Tests</h1>
<p>Compile and run the tests</p>
<div class="fragment"><div class="line">make test</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Using Web Connections</h1>
<p>The code automatically binds to Port 8012. To access this service, ngrok is recommended.</p>
<p>To run ngrok for this program, open another command prompt and do</p>
<div class="fragment"><div class="line">ngrok http 8012 </div>
</div><!-- fragment --><p> If you have a URL from ngrok, you can append it here. For example</p>
<div class="fragment"><div class="line">ngrok http --url basically-sure-piranha.ngrok-free.app 8012 </div>
</div><!-- fragment --><p>Alternatively, you can open port 8012 in your router, but this will not be described here.</p>
<p><code>&lt;link&gt;</code> below will be the URL provided by ngrok (or <code>&lt;ip&gt;:8012</code> if port forwarding)</p>
<p>To add as a CI server, go to your GitHub Repo &gt; Settings &gt; Webhooks &gt; Add Webhook. Here, add <code>&lt;link&gt;/ci_webhook</code> as your Payload URL. Set Content type to <code>application/json</code>. Disable SSL verification. For events, select "Let me select individual events" and check <code>Pushes</code> and <code>Pull Requests</code>. Now the CI server should be good to go!</p>
<p>To get the list of all previous builds done, go to the following link: </p><div class="fragment"><div class="line">&lt;link&gt;/list</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Clean build folder</h1>
<p>Clean the compiled code build</p>
<div class="fragment"><div class="line">make clean </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
The Compilation</h1>
<p>To compile the programs during runtime, we have opted to use the std::system() function. This function will call <code>make -s</code> in the folder of the downloaded repository, and <code>make test -s</code> is used for testing. The system call results in a 0 if everything passed smoothly, while if there are any errors a non-zero result is returned. Logs are saved into a Sqlite3 database.</p>
<p>To unit test this, we have three fake testing repositories in the testing folder, one with code that will compile well, one with code that will not compile, and one without a Makefile. Unittests are run with Catch2 to make sure that the expected behaviour is had when running <code>make</code> in all three of these folders.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
The Testing</h1>
<p>To test a GitHub repo, we have set up a HTTP server through httplib which listens to Post messages on the <code>/ci_webhook</code> link. The request information sent by GitHub is then used to extrapolate all important information such as Commit ID, branch name and Cloning URL. The repo is then cloned using <code>std::system</code> calls, which downloads the requested testing repo. Using the methods explained above, the project is then compiled and tested. After compilation and testing, the commit status is updated, as explained below. The results and other important information is also added to the Database for future storage.</p>
<p>To unit test our implementation, we have set up separate testing repos that run on the same CI server. There are several different ones, one that has a functional compilation and passes testing, one that doesn't complete testing, one that doesn't compile and one that doesn't have a Makefile. Through this we can unit test the functionality of the CI server.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Commit Status</h1>
<p>To update the commit status, we needed to post a HTTPS message to the GitHub API. Luckily, the webhook included everything needed for us to get the URL and therefore the implementation could be done without too much hassle. In order to send the notification, we create a HTTPlib SSLClient for the github api, to which we make a payload with the status and a header with a GitHub authorization token. This is then posted to GitHub and the response is awaited, with the results being returned back.</p>
<p>Unit testing of this was a bit difficult, but we ended up using a separate repo with a set commit as our testing grounds. We use the function notifyCommitStatus to change the commit status and await the response from github to see whether it has passed or not.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Statement of Contributions</h1>
<p>This has been an interesting exercise, with a lot more intricacy and complexity than the first Assignment. But, even with that, we made it work, and even has the properties for P+ - this is something to be proud of!</p>
<p><b>All members</b> contributed with documentation and Pull Request checking/merging.</p>
<p><b>Rifat Kazi</b> - Database integration and Testing sequence.</p>
<p><b>Teo Nordstr√∂m</b> - Http interactions, README, GitHub status</p>
<p><b>Linus Svensson</b> - Repository cloning and compiling with corresponding tests</p>
<p><b>Syam Kumar Vemana</b> - Testing and evaluation of possible tools</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Licenses</h1>
<p>This project includes Catch2, which is licensed under the Boost Software License 1.0. The full license text can be found in <code>external/Catch2_LICENSE.txt</code>.</p>
<p>This project includes httplib, which is licensed under the MIT License. The full license text can be found in <code>external/httplib_LICENSE.txt</code>.</p>
<p>This project includes nlohmann json, which is licensed under the MIT License. The full license text can be found in <code>external/json_LICENSE.txt</code>.</p>
<p>The code developed in this project is licensed under the MIT License. The full license text can be found in <code>LICENSE</code>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
